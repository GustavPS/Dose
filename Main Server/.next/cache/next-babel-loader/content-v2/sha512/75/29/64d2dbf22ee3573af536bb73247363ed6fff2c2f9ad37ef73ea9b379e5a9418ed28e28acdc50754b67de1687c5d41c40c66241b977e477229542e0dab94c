{"ast":null,"code":"var _jsxFileName = \"/mnt/h/Code/Dose/Main Server/pages/server/[server]/movies/video/[id].js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport Head from 'next/head';\nimport Layout from '../../../../../components/layout';\nimport { useEffect, useState, useRef } from 'react';\nimport { useRouter } from 'next/router';\nimport { Form, Button, ListGroup, Image } from 'react-bootstrap';\nimport ReactPlayer from 'react-player';\nimport Styles from '../../../../../styles/video.module.css';\nimport fetch from 'node-fetch';\nimport vtt from 'vtt-live-edit';\nimport Router from 'next/router';\nimport VideoComponent from '../../../../../components/videoComponent';\nimport VideoTrailer from '.././../../../../components/videoTrailer';\nimport validateServerAccess from '../../../../../lib/validateServerAccess';\nimport Actor from '../../../../../components/actor';\nimport useWindowSize from '../../../../../components/hooks/WindowSize';\nimport MovieBackdrop from '../../../../../components/movieBackdrop';\nimport ChangeImages from '../../../../../components/changeImages'; // Fetcher for useSWR, redirect to login if not authorized\n\nvar fetchedMetadata = false;\nexport var __N_SSP = true;\nexport default function Home(props) {\n  _s();\n\n  var _this = this;\n\n  var server = props.server;\n  var router = useRouter();\n  var id = router.query.id;\n  var serverToken = props.serverToken;\n\n  var _useState = useState({}),\n      metadata = _useState[0],\n      setMetadata = _useState[1];\n\n  var _useState2 = useState(false),\n      watched = _useState2[0],\n      setWatched = _useState2[1];\n\n  var _useState3 = useState(false),\n      inWatchList = _useState3[0],\n      setInWatchList = _useState3[1];\n\n  var _useState4 = useState([]),\n      actors = _useState4[0],\n      setActors = _useState4[1];\n\n  var _useState5 = useState([]),\n      recommended = _useState5[0],\n      setRecommended = _useState5[1];\n\n  var _useState6 = useState(false),\n      viewTrailer = _useState6[0],\n      setViewTrailer = _useState6[1];\n\n  var _useState7 = useState(false),\n      trailer = _useState7[0],\n      setTrailer = _useState7[1];\n\n  var _useState8 = useState(false),\n      loaded = _useState8[0],\n      setLoaded = _useState8[1];\n\n  var _useState9 = useState(false),\n      recommendedLoaded = _useState9[0],\n      setRecommendedLoaded = _useState9[1];\n\n  var videoRef = useRef();\n  var windowSize = useWindowSize(); // Used for manual metadata search\n\n  var _useState10 = useState(false),\n      metadataBox = _useState10[0],\n      setMetadataBox = _useState10[1];\n\n  var _useState11 = useState([]),\n      metadataSearchResult = _useState11[0],\n      setMetadataSearchResult = _useState11[1];\n\n  var metadataSearch = useRef(null); // This has it's own useEffect because if it doesn't videojs doesn't work (????)\n\n  useEffect(function () {\n    validateServerAccess(server, function (serverToken) {\n      fetch(\"\".concat(server.server_ip, \"/api/movies/\").concat(id, \"/getRecommended?token=\").concat(serverToken), {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }).then(function (r) {\n        return r.json();\n      }).then(function (result) {\n        if (result.success) {\n          console.log(result);\n          result.movies.forEach(function (movie) {\n            var _iterator = _createForOfIteratorHelper(movie.images),\n                _step;\n\n            try {\n              for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                var image = _step.value;\n\n                if (image.active) {\n                  if (image.type === 'BACKDROP') {\n                    if (image.path === 'no_image') {\n                      movie.backdrop = null;\n                    } else {\n                      movie.backdrop = image.path;\n                    }\n                  } else {\n                    if (image.path === 'no_image') {\n                      movie.backdrop = null;\n                    } else {\n                      movie.poster = image.path;\n                    }\n                  }\n\n                  if (movie.backdrop != null && movie.poster != null) {\n                    break;\n                  }\n                }\n              }\n            } catch (err) {\n              _iterator.e(err);\n            } finally {\n              _iterator.f();\n            }\n          });\n          setRecommended(result.movies);\n        }\n      }).then(function () {\n        setRecommendedLoaded(true);\n      });\n      fetch(\"\".concat(server.server_ip, \"/api/movies/\").concat(id, \"?token=\").concat(serverToken), {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }).then(function (r) {\n        return r.json();\n      }).then(function (result) {\n        var meta = result.result;\n        console.log(meta);\n        var finish_at = new Date(new Date().getTime() + meta.runtime * 60000);\n        meta.finish_at = finish_at.getHours() + \":\" + finish_at.getMinutes();\n\n        var _iterator2 = _createForOfIteratorHelper(meta.images),\n            _step2;\n\n        try {\n          for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n            var image = _step2.value;\n\n            if (image.active && image.type === 'BACKDROP') {\n              meta.backdrop = image.path;\n            }\n\n            if (image.active && image.type === 'POSTER') {\n              meta.poster = image.path;\n            }\n          }\n        } catch (err) {\n          _iterator2.e(err);\n        } finally {\n          _iterator2.f();\n        }\n\n        var new_added_date = new Date(parseInt(meta.added_date));\n        var added_year = new_added_date.getFullYear();\n        var added_month = new_added_date.getMonth() + 1;\n\n        if (added_month < 10) {\n          added_month = \"0\" + added_month.toString();\n        }\n\n        var adde_date = new_added_date.getDate();\n\n        if (adde_date < 10) {\n          adde_date = \"0\" + adde_date.toString();\n        }\n\n        meta.added_date = \"\".concat(added_year, \"-\").concat(added_month, \"-\").concat(adde_date);\n        var currentTime = \"\";\n        var hours = Math.floor(meta.currentTime / 60 / 60);\n        var minutes = Math.floor(meta.currentTime / 60 % 60);\n        var seconds = Math.floor(meta.currentTime % 60);\n\n        if (hours >= 1) {\n          currentTime += \"\".concat(hours, \":\");\n        }\n\n        if (minutes < 10) {\n          minutes = \"0\".concat(minutes);\n        }\n\n        if (seconds < 10) {\n          seconds = \"0\".concat(seconds);\n        }\n\n        currentTime += \"\".concat(minutes, \":\").concat(seconds);\n        meta.currentTimeSeconds = meta.currentTime;\n        meta.currentTime = currentTime;\n        console.log(videoRef);\n        videoRef.current.setTitle(meta.title);\n        setInWatchList(meta.inwatchlist);\n        setWatched(meta.watched);\n        setMetadata(meta);\n        setTrailer(meta.trailer);\n        meta.actors = meta.actors.sort(function (a, b) {\n          return parseFloat(a.order) - parseFloat(b.order);\n        });\n        setActors(meta.actors);\n\n        if (router.query.autoPlay) {\n          videoRef.current.show();\n        }\n      }).then(function () {\n        setLoaded(true);\n      });\n    });\n  }, []);\n\n  var markAsWatched = function markAsWatched() {\n    validateServerAccess(server, function (serverToken) {\n      fetch(\"\".concat(server.server_ip, \"/api/movies/\").concat(id, \"/setWatched?watched=true&token=\").concat(serverToken)).then(function (r) {\n        return r.json();\n      }).then(function (status) {\n        if (status.success) {\n          setWatched(true);\n        } else {\n          console.log(\"ERROR MARKING AS WATCHED: \" + status);\n        }\n      })[\"catch\"](function (err) {\n        console.log(err);\n      });\n    });\n  };\n\n  var markAsNotWatched = function markAsNotWatched() {\n    validateServerAccess(server, function (serverToken) {\n      fetch(\"\".concat(server.server_ip, \"/api/movies/\").concat(id, \"/setWatched?watched=false&token=\").concat(serverToken)).then(function (r) {\n        return r.json();\n      }).then(function (status) {\n        if (status.success) {\n          setWatched(false);\n        } else {\n          console.log(\"ERROR MARKING AS WATCHED: \" + status);\n        }\n      })[\"catch\"](function (err) {\n        console.log(err);\n      });\n    });\n  };\n\n  var addToWatchList = function addToWatchList() {\n    validateServerAccess(server, function (serverToken) {\n      fetch(\"\".concat(server.server_ip, \"/api/movies/\").concat(id, \"/addToWatchList?add=true&token=\").concat(serverToken)).then(function (r) {\n        return r.json();\n      }).then(function (status) {\n        if (status.success) {\n          setInWatchList(true);\n        } else {\n          console.log(\"ERROR adding to watchlist: \" + status);\n        }\n      })[\"catch\"](function (err) {\n        console.log(err);\n      });\n    });\n  };\n\n  var removeFromWatchList = function removeFromWatchList() {\n    validateServerAccess(server, function (serverToken) {\n      fetch(\"\".concat(server.server_ip, \"/api/movies/\").concat(id, \"/addToWatchList?add=false&token=\").concat(serverToken)).then(function (r) {\n        return r.json();\n      }).then(function (status) {\n        if (status.success) {\n          setInWatchList(false);\n        } else {\n          console.log(\"ERROR removing from watchlist: \" + status);\n        }\n      })[\"catch\"](function (err) {\n        console.log(err);\n      });\n    });\n  };\n\n  var searchMetadata = function searchMetadata(event) {\n    var search = metadataSearch.current.value;\n\n    if (search != \"\") {\n      validateServerAccess(server, function (serverToken) {\n        fetch(\"\".concat(server.server_ip, \"/api/movies/searchMetadata?search=\").concat(search, \"&token=\").concat(serverToken)).then(function (r) {\n          return r.json();\n        }).then(function (result) {\n          console.log(result);\n          var metadataElements = [];\n\n          var _iterator3 = _createForOfIteratorHelper(result),\n              _step3;\n\n          try {\n            var _loop = function _loop() {\n              var movie = _step3.value;\n              var img = movie.poster_path !== null ? \"https://image.tmdb.org/t/p/w500/\".concat(movie.poster_path) : 'https://via.placeholder.com/500x750';\n              metadataElements.push(__jsx(ListGroup.Item, {\n                key: movie.id,\n                className: Styles.metadataSearchRow,\n                \"data-metadataid\": movie.id,\n                __self: _this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 251,\n                  columnNumber: 15\n                }\n              }, __jsx(Image, {\n                src: img,\n                __self: _this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 252,\n                  columnNumber: 17\n                }\n              }), __jsx(\"div\", {\n                __self: _this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 253,\n                  columnNumber: 17\n                }\n              }, __jsx(\"h5\", {\n                __self: _this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 254,\n                  columnNumber: 19\n                }\n              }, movie.title), __jsx(\"p\", {\n                __self: _this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 255,\n                  columnNumber: 19\n                }\n              }, movie.overview)), __jsx(Button, {\n                onClick: function onClick() {\n                  return updateMetadata(movie.id);\n                },\n                __self: _this,\n                __source: {\n                  fileName: _jsxFileName,\n                  lineNumber: 257,\n                  columnNumber: 17\n                }\n              }, \"V\\xE4lj\")));\n            };\n\n            for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n              _loop();\n            }\n          } catch (err) {\n            _iterator3.e(err);\n          } finally {\n            _iterator3.f();\n          }\n\n          setMetadataSearchResult(metadataElements);\n        });\n      });\n    }\n\n    event.preventDefault();\n  };\n\n  var updateMetadata = function updateMetadata(metadataID) {\n    validateServerAccess(server, function (serverToken) {\n      fetch(\"\".concat(server.server_ip, \"/api/movies/\").concat(id, \"/updateMetadata?metadataID=\").concat(metadataID, \"&token=\").concat(serverToken)).then(function (r) {\n        return r.json();\n      }).then(function (json) {\n        if (json.success) {\n          Router.reload(window.location.pathname);\n        }\n      });\n    });\n  };\n\n  var getActors = function getActors() {\n    var elements = [];\n\n    var _iterator4 = _createForOfIteratorHelper(actors),\n        _step4;\n\n    try {\n      for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n        var actor = _step4.value;\n        elements.push(__jsx(Actor, {\n          name: actor.name,\n          characterName: actor.character,\n          image: actor.image,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 9\n          }\n        }));\n      }\n    } catch (err) {\n      _iterator4.e(err);\n    } finally {\n      _iterator4.f();\n    }\n\n    return elements;\n  };\n\n  var getRecommended = function getRecommended() {\n    var elements = [];\n\n    var _iterator5 = _createForOfIteratorHelper(recommended),\n        _step5;\n\n    try {\n      var _loop2 = function _loop2() {\n        var movie = _step5.value;\n        var img = movie.backdrop !== null ? \"https://image.tmdb.org/t/p/w500/\".concat(movie.backdrop) : 'https://via.placeholder.com/2000x1000';\n        elements.push(__jsx(MovieBackdrop, {\n          markAsDoneButton: true,\n          id: movie.id,\n          time: 0,\n          runtime: 0,\n          title: movie.title,\n          overview: movie.overview,\n          backdrop: img,\n          onClick: function onClick(id) {\n            return selectMovie(movie.id);\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 11\n          }\n        }));\n      };\n\n      for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n        _loop2();\n      }\n    } catch (err) {\n      _iterator5.e(err);\n    } finally {\n      _iterator5.f();\n    }\n\n    return elements;\n  };\n\n  var selectMovie = function selectMovie(id) {\n    Router.push(\"/server/\".concat(server.server_id, \"/movies/video/\").concat(id));\n    Router.events.on(\"routeChangeComplete\", function () {\n      Router.reload(window.location.pathname);\n    });\n  };\n\n  var scrollLeft = function scrollLeft(id) {\n    document.getElementById(id).scrollLeft -= window.innerWidth * 0.8;\n    window.scrollTo(window.scrollX, window.scrollY - 1);\n    window.scrollTo(window.scrollX, window.scrollY + 1);\n  };\n\n  var scrollRight = function scrollRight(id) {\n    document.getElementById(id).scrollLeft += window.innerWidth * 0.8;\n    window.scrollTo(window.scrollX, window.scrollY - 1);\n    window.scrollTo(window.scrollX, window.scrollY + 1);\n  };\n\n  return __jsx(React.Fragment, null, __jsx(VideoComponent, {\n    ref: videoRef,\n    server: server,\n    serverToken: serverToken,\n    internalID: id,\n    Movie: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 5\n    }\n  }), __jsx(Head, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 329,\n      columnNumber: 5\n    }\n  }, __jsx(\"link\", {\n    href: \"https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap\",\n    rel: \"stylesheet\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 5\n    }\n  }), __jsx(\"script\", {\n    src: \"https://vjs.zencdn.net/7.7.6/video.js\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 5\n    }\n  }), __jsx(\"script\", {\n    src: \"http://code.jquery.com/jquery-1.9.1.min.js\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 5\n    }\n  }), __jsx(\"link\", {\n    href: \"https://vjs.zencdn.net/7.7.6/video-js.css\",\n    rel: \"stylesheet\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 334,\n      columnNumber: 5\n    }\n  }), __jsx(\"script\", {\n    type: \"text/javascript\",\n    src: \"https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 335,\n      columnNumber: 5\n    }\n  })), (!loaded || !recommendedLoaded) && __jsx(\"div\", {\n    className: Styles.loadingioSpinnerEclipse,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: Styles.ldio,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 15\n    }\n  }))), loaded && recommendedLoaded && __jsx(React.Fragment, null, trailer !== false && viewTrailer && __jsx(VideoTrailer, {\n    onClose: function onClose() {\n      return setViewTrailer(false);\n    },\n    videoPath: trailer,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 352,\n      columnNumber: 5\n    }\n  }), __jsx(\"div\", {\n    id: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 356,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    style: {\n      backgroundImage: \"url('https://image.tmdb.org/t/p/original\".concat(metadata.backdrop, \"')\")\n    },\n    className: Styles.background,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 357,\n      columnNumber: 5\n    }\n  }), __jsx(\"div\", {\n    className: \"backIcon\",\n    onClick: function onClick() {\n      Router.back();\n      Router.events.on(\"routeChangeComplete\", function () {\n        Router.reload(window.location.pathname);\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 5\n    }\n  }), metadataBox && __jsx(\"div\", {\n    className: \"metadataBox\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 367,\n      columnNumber: 7\n    }\n  }, __jsx(Form, {\n    onSubmit: searchMetadata,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 9\n    }\n  }, __jsx(Form.Group, {\n    controlId: \"formSearch\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 369,\n      columnNumber: 11\n    }\n  }, __jsx(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 370,\n      columnNumber: 13\n    }\n  }, \"Uppdatera metadata f\\xF6r \", metadata.path), __jsx(Form.Control, {\n    ref: metadataSearch,\n    type: \"text\",\n    placeholder: \"S\\xF6k efter ny metadata...\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 371,\n      columnNumber: 13\n    }\n  })), __jsx(Button, {\n    variant: \"primary\",\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 373,\n      columnNumber: 11\n    }\n  }, \"S\\xF6k\")), __jsx(\"div\", {\n    style: {\n      clear: 'both'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 377,\n      columnNumber: 9\n    }\n  }), __jsx(ListGroup, {\n    id: \"metadataSearchResult\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 9\n    }\n  }, metadataSearchResult)), __jsx(\"div\", {\n    className: Styles.top,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 386,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: Styles.poster,\n    style: {\n      backgroundImage: \"url('https://image.tmdb.org/t/p/original\".concat(metadata.poster, \"')\")\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 7\n    }\n  }), __jsx(\"div\", {\n    className: Styles.description,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 7\n    }\n  }, __jsx(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 9\n    }\n  }, metadata.title), __jsx(\"div\", {\n    className: Styles.metadata,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 390,\n      columnNumber: 9\n    }\n  }, __jsx(\"p\", {\n    className: Styles.releaseDate,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 11\n    }\n  }, metadata.release_date), __jsx(\"p\", {\n    className: Styles.runtime,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 392,\n      columnNumber: 11\n    }\n  }, Math.floor(metadata.runtime / 60) + \"h \" + metadata.runtime % 60 + \"m\"), __jsx(\"p\", {\n    className: Styles.endsat,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 11\n    }\n  }, \"Slutar vid \", metadata.finish_at), __jsx(\"p\", {\n    className: Styles.addedDate,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 11\n    }\n  }, \"Tillagd \", metadata.added_date)), __jsx(\"div\", {\n    className: Styles.overview,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 396,\n      columnNumber: 9\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 397,\n      columnNumber: 13\n    }\n  }, metadata.overview)), __jsx(\"div\", {\n    className: Styles.actions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 399,\n      columnNumber: 9\n    }\n  }, metadata.currentTimeSeconds > 0 && __jsx(\"div\", {\n    style: {\n      marginRight: \"15px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: Styles.playButton,\n    onClick: function onClick() {\n      return videoRef.current.show(metadata.currentTimeSeconds);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 13\n    }\n  }), __jsx(\"p\", {\n    style: {\n      marginTop: \"5px\",\n      fontSize: '14px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 13\n    }\n  }, \"\\xC5teruppta fr\\xE5n \", metadata.currentTime)), __jsx(\"div\", {\n    style: {\n      marginRight: \"15px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 406,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: Styles.playButton,\n    onClick: function onClick() {\n      return videoRef.current.show();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 13\n    }\n  }), __jsx(\"p\", {\n    style: {\n      marginTop: \"5px\",\n      fontSize: '14px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 408,\n      columnNumber: 13\n    }\n  }, \"Spela fr\\xE5n b\\xF6rjan\")), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: Styles.playButton,\n    onClick: function onClick() {\n      return setViewTrailer(true);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 411,\n      columnNumber: 13\n    }\n  }), __jsx(\"p\", {\n    style: {\n      marginTop: \"5px\",\n      fontSize: '14px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 13\n    }\n  }, \"Visa trailer\")), watched && __jsx(React.Fragment, null, __jsx(\"div\", {\n    style: {\n      marginLeft: \"15px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 416,\n      columnNumber: 15\n    }\n  }, __jsx(\"div\", {\n    id: \"markAsWatched\",\n    style: {\n      backgroundImage: \"url('\".concat(process.env.NEXT_PUBLIC_SERVER_URL, \"/images/cross.svg')\")\n    },\n    className: Styles.playButton,\n    onClick: function onClick() {\n      return markAsNotWatched();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 417,\n      columnNumber: 15\n    }\n  }), __jsx(\"p\", {\n    id: \"markAsWatchedText\",\n    style: {\n      marginTop: \"5px\",\n      fontSize: '14px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 418,\n      columnNumber: 15\n    }\n  }, \"Markera som osedd\"))), !watched && __jsx(React.Fragment, null, __jsx(\"div\", {\n    style: {\n      marginLeft: \"15px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 424,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    id: \"markAsWatched\",\n    style: {\n      backgroundImage: \"url('\".concat(process.env.NEXT_PUBLIC_SERVER_URL, \"/images/eye.svg')\")\n    },\n    className: Styles.playButton,\n    onClick: function onClick() {\n      return markAsWatched();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 425,\n      columnNumber: 15\n    }\n  }), __jsx(\"p\", {\n    id: \"markAsWatchedText\",\n    style: {\n      marginTop: \"5px\",\n      fontSize: '14px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 15\n    }\n  }, \"Markera som sedd\"))), inWatchList && __jsx(React.Fragment, null, __jsx(\"div\", {\n    style: {\n      marginLeft: \"15px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 432,\n      columnNumber: 15\n    }\n  }, __jsx(\"div\", {\n    id: \"inWatchList\",\n    style: {\n      backgroundImage: \"url('\".concat(process.env.NEXT_PUBLIC_SERVER_URL, \"/images/cross.svg')\")\n    },\n    className: Styles.playButton,\n    onClick: function onClick() {\n      return removeFromWatchList();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 433,\n      columnNumber: 15\n    }\n  }), __jsx(\"p\", {\n    id: \"inWatchListText\",\n    style: {\n      marginTop: \"5px\",\n      fontSize: '14px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 434,\n      columnNumber: 15\n    }\n  }, \"Ta bort fr\\xE5n watchlist\"))), !inWatchList && __jsx(React.Fragment, null, __jsx(\"div\", {\n    style: {\n      marginLeft: \"15px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 440,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    id: \"inWatchList\",\n    style: {\n      backgroundImage: \"url('\".concat(process.env.NEXT_PUBLIC_SERVER_URL, \"/images/eye.svg')\")\n    },\n    className: Styles.playButton,\n    onClick: function onClick() {\n      return addToWatchList();\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 441,\n      columnNumber: 15\n    }\n  }), __jsx(\"p\", {\n    id: \"inWatchListText\",\n    style: {\n      marginTop: \"5px\",\n      fontSize: '14px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 442,\n      columnNumber: 15\n    }\n  }, \"L\\xE4gg till i watchlist\"))), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 446,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    style: {\n      marginLeft: \"15px\",\n      backgroundImage: \"url('\".concat(process.env.NEXT_PUBLIC_SERVER_URL, \"/images/search.svg')\")\n    },\n    className: Styles.playButton,\n    onClick: function onClick() {\n      return setMetadataBox(true);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 447,\n      columnNumber: 13\n    }\n  }), __jsx(\"p\", {\n    style: {\n      marginLeft: \"15px\",\n      marginTop: \"5px\",\n      fontSize: '14px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 448,\n      columnNumber: 13\n    }\n  }, \"Uppdatera metadata\")), __jsx(ChangeImages, {\n    id: id,\n    server: server,\n    serverToken: serverToken,\n    type: \"movies\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 451,\n      columnNumber: 11\n    }\n  })))), __jsx(\"div\", {\n    className: Styles.bottom,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 456,\n      columnNumber: 5\n    }\n  }, __jsx(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 457,\n      columnNumber: 7\n    }\n  }, \"Actors\"), __jsx(\"div\", {\n    className: Styles.actors,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 458,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    id: \"actors\",\n    className: Styles.actorBox,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 459,\n      columnNumber: 9\n    }\n  }, getActors()), actors.length * 200 > windowSize.width && __jsx(React.Fragment, null, __jsx(\"div\", {\n    className: Styles.scrollButton,\n    onClick: function onClick() {\n      return scrollLeft('actors');\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 464,\n      columnNumber: 37\n    }\n  }, __jsx(\"img\", {\n    src: \"\".concat(process.env.NEXT_PUBLIC_SERVER_URL, \"/images/left.svg\"),\n    width: \"70\",\n    height: \"70\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 465,\n      columnNumber: 41\n    }\n  })), __jsx(\"div\", {\n    className: Styles.scrollButton,\n    style: {\n      right: '0'\n    },\n    onClick: function onClick() {\n      return scrollRight('actors');\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 467,\n      columnNumber: 37\n    }\n  }, __jsx(\"img\", {\n    src: \"\".concat(process.env.NEXT_PUBLIC_SERVER_URL, \"/images/right.svg\"),\n    width: \"70\",\n    height: \"70\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 468,\n      columnNumber: 41\n    }\n  })))), __jsx(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 474,\n      columnNumber: 5\n    }\n  }, \"Recommended\"), recommended.length > 0 && __jsx(\"div\", {\n    style: {\n      position: 'relative'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 476,\n      columnNumber: 21\n    }\n  }, __jsx(\"div\", {\n    className: Styles.movieRow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 477,\n      columnNumber: 25\n    }\n  }, __jsx(\"div\", {\n    id: \"recommended\",\n    className: Styles.scrollable,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 478,\n      columnNumber: 29\n    }\n  }, getRecommended()), recommended.length * 480 > windowSize.width && __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 482,\n      columnNumber: 33\n    }\n  }, __jsx(\"div\", {\n    className: Styles.scrollButton,\n    onClick: function onClick() {\n      return scrollLeft('recommended');\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 483,\n      columnNumber: 37\n    }\n  }, __jsx(\"img\", {\n    src: \"\".concat(process.env.NEXT_PUBLIC_SERVER_URL, \"/images/left.svg\"),\n    width: \"70\",\n    height: \"70\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 484,\n      columnNumber: 41\n    }\n  })), __jsx(\"div\", {\n    className: Styles.scrollButton,\n    style: {\n      right: '0'\n    },\n    onClick: function onClick() {\n      return scrollRight('recommended');\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 486,\n      columnNumber: 37\n    }\n  }, __jsx(\"img\", {\n    src: \"\".concat(process.env.NEXT_PUBLIC_SERVER_URL, \"/images/right.svg\"),\n    width: \"70\",\n    height: \"70\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 487,\n      columnNumber: 41\n    }\n  })))), __jsx(\"hr\", {\n    className: Styles.divider,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 492,\n      columnNumber: 21\n    }\n  }))))));\n} // Get the information about the server and send it to the front end before render (this is server-side)\n\n_s(Home, \"4EQ0Dn6qwBeG0xAjpj09wg9FiGY=\", false, function () {\n  return [useRouter, useWindowSize];\n});\n\n_c = Home;\n\nvar _c;\n\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"sources":["/mnt/h/Code/Dose/Main Server/pages/server/[server]/movies/video/[id].js"],"names":["Head","Layout","useEffect","useState","useRef","useRouter","Form","Button","ListGroup","Image","ReactPlayer","Styles","fetch","vtt","Router","VideoComponent","VideoTrailer","validateServerAccess","Actor","useWindowSize","MovieBackdrop","ChangeImages","fetchedMetadata","Home","props","server","router","id","query","serverToken","metadata","setMetadata","watched","setWatched","inWatchList","setInWatchList","actors","setActors","recommended","setRecommended","viewTrailer","setViewTrailer","trailer","setTrailer","loaded","setLoaded","recommendedLoaded","setRecommendedLoaded","videoRef","windowSize","metadataBox","setMetadataBox","metadataSearchResult","setMetadataSearchResult","metadataSearch","server_ip","method","headers","then","r","json","result","success","console","log","movies","forEach","movie","images","image","active","type","path","backdrop","poster","meta","finish_at","Date","getTime","runtime","getHours","getMinutes","new_added_date","parseInt","added_date","added_year","getFullYear","added_month","getMonth","toString","adde_date","getDate","currentTime","hours","Math","floor","minutes","seconds","currentTimeSeconds","current","setTitle","title","inwatchlist","sort","a","b","parseFloat","order","autoPlay","show","markAsWatched","status","err","markAsNotWatched","addToWatchList","removeFromWatchList","searchMetadata","event","search","value","metadataElements","img","poster_path","push","metadataSearchRow","overview","updateMetadata","preventDefault","metadataID","reload","window","location","pathname","getActors","elements","actor","name","character","getRecommended","selectMovie","server_id","events","on","scrollLeft","document","getElementById","innerWidth","scrollTo","scrollX","scrollY","scrollRight","loadingioSpinnerEclipse","ldio","backgroundImage","background","back","clear","top","description","releaseDate","release_date","endsat","addedDate","actions","marginRight","playButton","marginTop","fontSize","marginLeft","process","env","NEXT_PUBLIC_SERVER_URL","bottom","actorBox","length","width","scrollButton","right","position","movieRow","scrollable","divider"],"mappings":"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","sourcesContent":["import Head from 'next/head'\nimport Layout from '../../../../../components/layout';\nimport { useEffect, useState, useRef } from 'react';\nimport { useRouter } from 'next/router'\nimport { Form, Button, ListGroup, Image} from 'react-bootstrap';\nimport ReactPlayer from 'react-player'\nimport Styles from '../../../../../styles/video.module.css';\nimport fetch from 'node-fetch'\nimport vtt from 'vtt-live-edit';\nimport Router from 'next/router';\nimport cookies from 'next-cookies'\n\nimport VideoComponent from '../../../../../components/videoComponent';\nimport VideoTrailer from '.././../../../../components/videoTrailer';\nimport validateServerAccess from '../../../../../lib/validateServerAccess';\nimport Actor from '../../../../../components/actor';\nimport useWindowSize from '../../../../../components/hooks/WindowSize';\nimport MovieBackdrop from '../../../../../components/movieBackdrop';\n\n\n\nimport ChangeImages from '../../../../../components/changeImages';\n\n// Fetcher for useSWR, redirect to login if not authorized\nlet fetchedMetadata = false;\n\n\nexport default function Home(props) {\n  const server = props.server;\n  const router = useRouter();\n  const { id } = router.query;\n  const serverToken = props.serverToken;\n  const [metadata, setMetadata] = useState({});\n  const [watched, setWatched] = useState(false);\n  const [inWatchList, setInWatchList] = useState(false);\n  const [actors, setActors] = useState([]);\n  const [recommended, setRecommended] = useState([]);\n\n  const [viewTrailer, setViewTrailer] = useState(false);\n  const [trailer, setTrailer] = useState(false);\n\n  const [loaded, setLoaded] = useState(false)\n  const [recommendedLoaded, setRecommendedLoaded] = useState(false);\n\n  const videoRef = useRef();\n  const windowSize = useWindowSize();\n\n\n\n  // Used for manual metadata search\n  const [metadataBox, setMetadataBox] = useState(false);\n  const [metadataSearchResult, setMetadataSearchResult] = useState([]);\n  const metadataSearch = useRef(null);\n\n\n\n  // This has it's own useEffect because if it doesn't videojs doesn't work (????)\n  useEffect(() => {\n    validateServerAccess(server, (serverToken) => {\n      fetch(`${server.server_ip}/api/movies/${id}/getRecommended?token=${serverToken}`, {\n        method: 'GET',\n        headers: {\n            'Content-Type': 'application/json'\n        }\n      })\n      .then(r => r.json())\n      .then(result => {\n        if (result.success) {\n          console.log(result);\n          result.movies.forEach(movie => {\n            for (let image of movie.images) {\n                if (image.active) {\n                    if (image.type === 'BACKDROP') {\n                        if (image.path === 'no_image') {\n                            movie.backdrop = null;\n                        } else {\n                            movie.backdrop = image.path;\n                        }\n                    } else {\n                        if (image.path === 'no_image') {\n                            movie.backdrop = null;\n                        } else {\n                            movie.poster = image.path;\n                        }\n                    }\n\n                    if (movie.backdrop != null && movie.poster != null) {\n                        break;\n                    }\n                }\n            }\n        });\n          setRecommended(result.movies);\n        }\n      })\n      .then(() => {\n        setRecommendedLoaded(true);\n      });\n\n\n\n      fetch(`${server.server_ip}/api/movies/${id}?token=${serverToken}`, {\n        method: 'GET',\n        headers: {\n            'Content-Type': 'application/json'\n        }\n      })\n      .then(r => r.json())\n      .then(result => {\n        let meta = result.result;\n        console.log(meta)\n        let finish_at = new Date(new Date().getTime() + meta.runtime * 60000);\n        meta.finish_at = finish_at.getHours() + \":\" + finish_at.getMinutes();\n        for (let image of meta.images) {\n          if (image.active && image.type === 'BACKDROP') {\n            meta.backdrop = image.path;\n          }\n          if (image.active && image.type === 'POSTER') {\n            meta.poster = image.path;\n          }\n        }\n        \n        let new_added_date = new Date(parseInt(meta.added_date));\n        let added_year = new_added_date.getFullYear();\n        let added_month = new_added_date.getMonth() + 1;\n        if(added_month < 10) {\n          added_month = \"0\" + added_month.toString();\n        }\n        let adde_date = new_added_date.getDate();\n        if(adde_date < 10) {\n          adde_date = \"0\" + adde_date.toString();\n        }\n        meta.added_date = `${added_year}-${added_month}-${adde_date}`\n  \n        let currentTime = \"\";\n        let hours = Math.floor(meta.currentTime / 60 / 60)\n        let minutes = Math.floor((meta.currentTime / 60) % 60)\n        let seconds = Math.floor(meta.currentTime % 60);\n        if (hours >= 1) {\n          currentTime += `${hours}:`\n        }\n        if (minutes < 10) {\n          minutes = `0${minutes}`;\n        }\n        if (seconds < 10) {\n          seconds = `0${seconds}`\n        }\n        currentTime += `${minutes}:${seconds}`\n        meta.currentTimeSeconds = meta.currentTime;\n        meta.currentTime = currentTime;\n        console.log(videoRef)\n        videoRef.current.setTitle(meta.title);\n  \n        setInWatchList(meta.inwatchlist);\n        setWatched(meta.watched);\n        setMetadata(meta);\n        setTrailer(meta.trailer);\n        meta.actors = meta.actors.sort((a, b) => {\n          return parseFloat(a.order) - parseFloat(b.order);\n        });\n        setActors(meta.actors);\n\n        if (router.query.autoPlay) {\n          videoRef.current.show();\n        }\n      }).then(() => {\n        setLoaded(true)\n      });\n    });\n  }, []);\n\n  const markAsWatched = () => {\n    validateServerAccess(server, (serverToken) => {\n      fetch(`${server.server_ip}/api/movies/${id}/setWatched?watched=true&token=${serverToken}`)\n      .then(r => r.json())\n      .then(status => {\n        if (status.success) {\n          setWatched(true);\n        } else {\n          console.log(\"ERROR MARKING AS WATCHED: \" + status);\n        }\n      }).catch(err => {\n        console.log(err);\n      });\n    });\n\n  }\n\n  const markAsNotWatched = () => {\n    validateServerAccess(server, (serverToken) => {\n      fetch(`${server.server_ip}/api/movies/${id}/setWatched?watched=false&token=${serverToken}`)\n      .then(r => r.json())\n      .then(status => {\n        if (status.success) {\n          setWatched(false);\n        } else {\n          console.log(\"ERROR MARKING AS WATCHED: \" + status);\n        }\n      })\n      .catch(err => {\n        console.log(err);\n      });\n    });\n  }\n\n  const addToWatchList = () => {\n    validateServerAccess(server, (serverToken) => {\n      fetch(`${server.server_ip}/api/movies/${id}/addToWatchList?add=true&token=${serverToken}`)\n      .then(r => r.json())\n      .then(status => {\n        if (status.success) {\n          setInWatchList(true);\n        } else {\n          console.log(\"ERROR adding to watchlist: \" + status);\n        }\n      })      .catch(err => {\n        console.log(err);\n      });\n    });\n  }\n\n  const removeFromWatchList = () => {\n    validateServerAccess(server, (serverToken) => {\n      fetch(`${server.server_ip}/api/movies/${id}/addToWatchList?add=false&token=${serverToken}`)\n      .then(r => r.json())\n      .then(status => {\n        if (status.success) {\n          setInWatchList(false);\n        } else {\n          console.log(\"ERROR removing from watchlist: \" + status);\n        }\n      })\n      .catch(err => {\n        console.log(err);\n      });\n    });\n  }\n\n  const searchMetadata = (event) => {\n    let search = metadataSearch.current.value;\n    if(search != \"\"){\n      validateServerAccess(server, (serverToken) => {\n        fetch(`${server.server_ip}/api/movies/searchMetadata?search=${search}&token=${serverToken}`)\n        .then(r => r.json())\n        .then(result => {\n          console.log(result);\n          let metadataElements = [];\n          for (let movie of result) {\n            let img = movie.poster_path !== null ? `https://image.tmdb.org/t/p/w500/${movie.poster_path}` : 'https://via.placeholder.com/500x750' \n            metadataElements.push(\n              <ListGroup.Item key={movie.id} className={Styles.metadataSearchRow} data-metadataid={movie.id}>\n                <Image src={img} />\n                <div>\n                  <h5>{movie.title}</h5>\n                  <p>{movie.overview}</p>\n                </div>\n                <Button onClick={() => updateMetadata(movie.id)}>Välj</Button>\n              </ListGroup.Item>\n            );        \n          }\n          setMetadataSearchResult(metadataElements);\n        });\n      });\n    }\n   \n    event.preventDefault();\n  }\n\n  const updateMetadata = (metadataID) => {\n    validateServerAccess(server, (serverToken) => {\n      fetch(`${server.server_ip}/api/movies/${id}/updateMetadata?metadataID=${metadataID}&token=${serverToken}`)\n      .then(r => r.json())\n      .then(json => {\n        if (json.success) {\n          Router.reload(window.location.pathname);\n        }\n      });\n    });\n  }\n\n\n  const getActors = () => {\n    let elements = [];\n    for (const actor of actors) {\n      elements.push(\n        <Actor name={actor.name} characterName={actor.character} image={actor.image} />\n      )\n    }\n    return elements;\n  }\n\n  const getRecommended = () => {\n    let elements = [];\n    for (const movie of recommended) {\n      let img = movie.backdrop !== null ? `https://image.tmdb.org/t/p/w500/${movie.backdrop}` : 'https://via.placeholder.com/2000x1000' \n      elements.push(\n          <MovieBackdrop markAsDoneButton id={movie.id} time={0} runtime={0} title={movie.title} overview={movie.overview} backdrop={img} onClick={(id) => selectMovie(movie.id)}></MovieBackdrop>\n      );\n    }\n    return elements;\n  }\n\n  const selectMovie = (id) => {\n    Router.push(`/server/${server.server_id}/movies/video/${id}`);\n    Router.events.on(\"routeChangeComplete\", () => {\n      Router.reload(window.location.pathname);\n\n\n    });\n  }\n  \n  const scrollLeft = (id) => {\n    document.getElementById(id).scrollLeft -= (window.innerWidth)*0.8;\n    window.scrollTo(window.scrollX, window.scrollY - 1);\n    window.scrollTo(window.scrollX, window.scrollY + 1);\n  }\n  const scrollRight = (id) => {\n      document.getElementById(id).scrollLeft += (window.innerWidth)*0.8;\n      window.scrollTo(window.scrollX, window.scrollY - 1);\n      window.scrollTo(window.scrollX, window.scrollY + 1);\n  }\n  \n  return (\n    <>\n    <VideoComponent ref={videoRef} server={server} serverToken={serverToken}\n                    internalID={id} Movie\n                    >\n    </VideoComponent>\n    <Head>\n    <link href=\"https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap\" rel=\"stylesheet\" />\n    <script src=\"https://vjs.zencdn.net/7.7.6/video.js\"></script>\n\n    <script src=\"http://code.jquery.com/jquery-1.9.1.min.js\"></script>\n    <link href=\"https://vjs.zencdn.net/7.7.6/video-js.css\" rel=\"stylesheet\" />\n    <script type=\"text/javascript\" src=\"https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1\"></script>\n\n    </Head>\n    {(!loaded || !recommendedLoaded) &&\n      <div className={Styles.loadingioSpinnerEclipse}>\n          <div className={Styles.ldio}>\n              <div></div>\n          </div>\n      </div>\n    }\n    {loaded && recommendedLoaded && \n    <>\n\n\n\n\n    {trailer !== false && viewTrailer &&\n    <VideoTrailer onClose={() => setViewTrailer(false)} videoPath={trailer} />\n    }\n\n\n    <div id=\"container\">\n    <div style={{backgroundImage: `url('https://image.tmdb.org/t/p/original${metadata.backdrop}')`}} className={Styles.background}></div>\n    <div className=\"backIcon\" onClick={() => {\n      Router.back();\n      Router.events.on(\"routeChangeComplete\", () => {\n        Router.reload(window.location.pathname);\n      });\n      }}></div>\n\n\n    {metadataBox &&\n      <div className=\"metadataBox\">\n        <Form onSubmit={searchMetadata}>\n          <Form.Group controlId=\"formSearch\">\n            <Form.Label>Uppdatera metadata för {metadata.path}</Form.Label>\n            <Form.Control ref={metadataSearch} type=\"text\" placeholder=\"Sök efter ny metadata...\" />\n          </Form.Group>\n          <Button variant=\"primary\" type=\"submit\">\n            Sök\n          </Button>\n        </Form>\n        <div style={{clear: 'both'}}></div>\n\n        <ListGroup id=\"metadataSearchResult\">\n          {metadataSearchResult}\n        </ListGroup>\n      </div>\n    }\n\n\n    <div className={Styles.top}>\n      <div className={Styles.poster} style={{backgroundImage: `url('https://image.tmdb.org/t/p/original${metadata.poster}')`}} />\n      <div className={Styles.description}>\n        <h1>{metadata.title}</h1>\n        <div className={Styles.metadata}>\n          <p className={Styles.releaseDate}>{metadata.release_date}</p>\n          <p className={Styles.runtime}>{Math.floor(metadata.runtime / 60) + \"h \" + metadata.runtime%60+\"m\"}</p>\n          <p className={Styles.endsat}>Slutar vid {metadata.finish_at}</p>\n          <p className={Styles.addedDate}>Tillagd {metadata.added_date}</p>\n        </div>\n        <div className={Styles.overview}>\n            <p>{metadata.overview}</p>\n        </div>\n        <div className={Styles.actions}>\n          {metadata.currentTimeSeconds > 0 &&\n          <div style={{marginRight: \"15px\"}}>\n            <div className={Styles.playButton} onClick={() => videoRef.current.show(metadata.currentTimeSeconds)}></div>\n            <p style={{marginTop: \"5px\", fontSize: '14px'}}>Återuppta från {metadata.currentTime}</p>\n          </div>\n          }\n          <div style={{marginRight: \"15px\"}}>\n            <div className={Styles.playButton} onClick={() => videoRef.current.show()}></div>\n            <p style={{marginTop: \"5px\", fontSize: '14px'}}>Spela från början</p>\n          </div>\n          <div>\n            <div className={Styles.playButton} onClick={() => setViewTrailer(true)}></div>\n            <p style={{marginTop: \"5px\", fontSize: '14px'}}>Visa trailer</p>\n          </div>\n          {watched &&\n          <>\n              <div style={{marginLeft: \"15px\"}}>\n              <div id=\"markAsWatched\" style={{backgroundImage: `url('${process.env.NEXT_PUBLIC_SERVER_URL}/images/cross.svg')`}} className={Styles.playButton} onClick={() => markAsNotWatched()}></div>\n              <p id=\"markAsWatchedText\" style={{marginTop: \"5px\", fontSize: '14px'}}>Markera som osedd</p>\n              </div>\n          </>\n          }\n          {!watched &&\n          <>\n            <div style={{marginLeft: \"15px\"}}>\n              <div id=\"markAsWatched\" style={{backgroundImage: `url('${process.env.NEXT_PUBLIC_SERVER_URL}/images/eye.svg')`}} className={Styles.playButton} onClick={() => markAsWatched()}></div>\n              <p id=\"markAsWatchedText\" style={{marginTop: \"5px\", fontSize: '14px'}}>Markera som sedd</p>\n            </div>\n          </>\n          }\n          {inWatchList &&\n          <>\n              <div style={{marginLeft: \"15px\"}}>\n              <div id=\"inWatchList\" style={{backgroundImage: `url('${process.env.NEXT_PUBLIC_SERVER_URL}/images/cross.svg')`}} className={Styles.playButton} onClick={() => removeFromWatchList()}></div>\n              <p id=\"inWatchListText\" style={{marginTop: \"5px\", fontSize: '14px'}}>Ta bort från watchlist</p>\n              </div>\n          </>\n          }\n          {!inWatchList &&\n          <>\n            <div style={{marginLeft: \"15px\"}}>\n              <div id=\"inWatchList\" style={{backgroundImage: `url('${process.env.NEXT_PUBLIC_SERVER_URL}/images/eye.svg')`}} className={Styles.playButton} onClick={() => addToWatchList()}></div>\n              <p id=\"inWatchListText\" style={{marginTop: \"5px\", fontSize: '14px'}}>Lägg till i watchlist</p>\n            </div>\n          </>\n          }\n          <div>\n            <div style={{marginLeft: \"15px\", backgroundImage: `url('${process.env.NEXT_PUBLIC_SERVER_URL}/images/search.svg')`}} className={Styles.playButton} onClick={() => setMetadataBox(true)}></div>\n            <p style={{marginLeft: \"15px\", marginTop: \"5px\", fontSize: '14px'}}>Uppdatera metadata</p>\n          </div>\n\n          <ChangeImages id={id} server={server} serverToken={serverToken} type=\"movies\"></ChangeImages>\n\n        </div>\n      </div>\n    </div>\n    <div className={Styles.bottom}>\n      <h1>Actors</h1>\n      <div className={Styles.actors}>\n        <div id=\"actors\" className={Styles.actorBox}>\n          {getActors()}\n        </div>\n        {actors.length * 200 > windowSize.width &&\n                                <>\n                                    <div className={Styles.scrollButton} onClick={() => scrollLeft('actors')}>\n                                        <img src={`${process.env.NEXT_PUBLIC_SERVER_URL}/images/left.svg`} width=\"70\" height=\"70\" />\n                                    </div>\n                                    <div className={Styles.scrollButton} style={{right: '0'}} onClick={() => scrollRight('actors')}>\n                                        <img src={`${process.env.NEXT_PUBLIC_SERVER_URL}/images/right.svg`} width=\"70\" height=\"70\" />\n                                    </div>\n                                </>\n                            }\n      </div>\n\n    <h1>Recommended</h1>\n    {recommended.length > 0 &&\n                    <div style={{position: 'relative'}}>\n                        <div className={Styles.movieRow}>\n                            <div id=\"recommended\" className={Styles.scrollable}>\n                                {getRecommended()}\n                            </div>\n                            {recommended.length * 480 > windowSize.width &&\n                                <div>\n                                    <div className={Styles.scrollButton} onClick={() => scrollLeft('recommended')}>\n                                        <img src={`${process.env.NEXT_PUBLIC_SERVER_URL}/images/left.svg`} width=\"70\" height=\"70\" />\n                                    </div>\n                                    <div className={Styles.scrollButton} style={{right: '0'}} onClick={() => scrollRight('recommended')}>\n                                        <img src={`${process.env.NEXT_PUBLIC_SERVER_URL}/images/right.svg`} width=\"70\" height=\"70\" />\n                                    </div>\n                                </div>\n                            }\n                        </div> \n                    <hr className={Styles.divider}></hr>\n                    </div> \n                }\n    </div>\n    </div>\n    </>\n    }\n    </>\n  )\n}\n\n// Get the information about the server and send it to the front end before render (this is server-side)\nexport async function getServerSideProps(context) {\n  let serverId = context.params.server;\n  let movieID = context.params.id;\n\n  return await fetch(`http://localhost:${process.env.SERVER_PORT}${process.env.SERVER_SUB_FOLDER}/api/servers/getServer`, {\n      method: 'POST',\n      headers: {\n          'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n          id: serverId\n      }),\n  })\n  .then((r) => r.json())\n  .then(async (data) =>{\n    return {\n      props: {\n          server: data.server,\n          serverToken: cookies(context).serverToken || ''\n      }\n    }\n\n  });\n}\n"]},"metadata":{},"sourceType":"module"}